function init(){task_list=store.get("tasks")||[],flag=store.get("flag")||0,addTaskList(),editTask(),delTask(),checkbox(),count()}function addTask(){$(".new-todo").on("keydown",function(t){if(13==t.which){var e={};if(e.content=$(this).val(),!/.*[^ ].*/.test(e.content))return;add_task(e),$(this).val(null),init()}})}function add_task(t){task_list.push(t),store.set("tasks",task_list)}function addTaskList(){var t=$(".todo-list"),e=$(".filters a"),s=[];t.html(null),e.removeAttr("class"),0==task_list.length?($(".main").hide(),$(".footer").hide()):($(".main").show(),$(".footer").show()),$(task_list).each(function(i,l){switch(flag){case 0:e.eq(0).attr("class","selected"),s=taskHtml(i,l),t.prepend(s);break;case 1:e.eq(1).attr("class","selected"),l.completed||(s=taskHtml(i,l),t.prepend(s));break;case 2:e.eq(2).attr("class","selected"),l.completed&&(s=taskHtml(i,l),t.prepend(s))}})}function taskHtml(t,e){return'<li data-index="'+t+'" class='+(e.completed?"completed":"")+'><div class="view"><input class="toggle" type="checkbox" '+(e.completed?"checked":"")+"><label>"+e.content+'</label><button class="destroy"></button></div><input class="edit" value="'+e.content+'"></li>'}function editTask(){$(".todo-list li").off("dblclick"),$(".todo-list li").on("dblclick",function(){$(this).addClass("editing");var t=$(this).find(".edit");t.focus().val(t.val()),t.on("blur",function(){$(this).parent().removeClass("editing");var t=$(this).parent().data("index");task_list[t].content=$(this).val(),store.set("tasks",task_list),init()}),t.on("keydown",function(t){if(13==t.which){$(this).parent().removeClass("editing");var e=$(this).parent().data("index");task_list[e].content=$(this).val(),store.set("tasks",task_list),init()}})})}function delTask(){$(".destroy").click(function(){var t=$(this).parent().parent().data("index");task_list.splice(t,1),store.set("tasks",task_list),init()})}function checkbox(){$(".toggle").click(function(){var t=$(this).parent().parent().data("index");task_list[t].completed?task_list[t].completed=!1:task_list[t].completed=!0,store.set("tasks",task_list),init()})}function count(){for(var t=0,e=0;e<task_list.length;e++)task_list[e].completed&&t++;var s=task_list.length-t;$(".todo-count strong").text(s),0!=t?$(".clear-completed").show():$(".clear-completed").hide();var i=$("#toggle-all");t==task_list.length?i.prop("checked","true"):i.prop("checked",null)}function checkboxAll(){$("#toggle-all").bind("click",function(){for(var t=0;t<task_list.length;t++)$(this).prop("checked")?task_list[t].completed=!0:task_list[t].completed=!1;store.set("tasks",task_list),init()})}function clickSelect(){$(".filters a").on("click",function(){var t=$(this).parent().index();store.set("flag",t),init()})}function clearCompleted(){$(".clear-completed").on("click",function(){for(var t=0;t<task_list.length;t++)task_list[t].completed&&(task_list.splice(t,1),t-=1);store.set("tasks",task_list),init()})}var task_list=[],flag=0;init(),addTask(),clickSelect(),clearCompleted(),checkboxAll();